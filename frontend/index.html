<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能留学选校规划系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 2rem auto;
            max-width: 1200px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .form-section {
            padding: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 1rem 3rem;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .results {
            display: none;
            padding: 2rem;
            background: #f8f9fa;
        }
        
        .analysis-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .school-recommendation {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
        }
        
        .case-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .case-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .similarity-score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .country-tag {
            display: inline-block;
            background: #e9ecef;
            color: #495057;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.85rem;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .country-tag.selected {
            background: #667eea;
            color: white;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border: 1px solid #f5c6cb;
        }
        
        /* V1.5 新增样式 */
        .form-section-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            margin: -2rem -2rem 2rem -2rem;
            border-radius: 15px 15px 0 0;
            border-bottom: 3px solid #667eea;
        }
        
        .form-section-title {
            color: #495057;
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
        }
        
        .form-section-subtitle {
            color: #6c757d;
            font-size: 0.95rem;
            margin: 0.5rem 0 0 0;
        }
        
        .form-section-content {
            padding: 0 2rem 2rem 2rem;
            margin: -2rem;
        }
        
        .dynamic-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            position: relative;
        }
        
        .dynamic-item .remove-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .add-item-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .add-item-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        
        .sortable-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .sortable-item:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .sortable-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }
        
        .drag-handle {
            color: #6c757d;
            margin-right: 0.5rem;
            font-size: 1.1rem;
        }
        
        .sortable-item:hover .drag-handle {
            color: #667eea;
        }
        
        /* V1.6.1 新增样式 - 禁用排序状态 */
        .disabled-sorting .sortable-item {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .disabled-sorting .drag-handle {
            color: #ccc !important;
        }
        
        .autocomplete-container {
            position: relative;
        }
        
        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 240px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .autocomplete-suggestion {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #f8f9fa;
            transition: background-color 0.2s ease;
            font-size: 0.95rem;
        }
        
        .autocomplete-suggestion:hover,
        .autocomplete-suggestion.active {
            background: #667eea;
            color: white;
        }
        
        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }
        
        .autocomplete-suggestion strong {
            font-weight: 600;
        }
        
        .autocomplete-suggestion:hover strong,
        .autocomplete-suggestion.active strong {
            color: #fff;
        }
        
        .submit-btn-container {
            text-align: center;
            padding: 2rem;
            background: #f8f9fa;
            margin: 2rem -2rem -2rem -2rem;
            border-radius: 0 0 15px 15px;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 1rem 3rem;
            font-weight: 600;
            font-size: 1.1rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.6;
            pointer-events: none;
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            pointer-events: none;
            cursor: not-allowed;
        }
        
        .submit-btn.enabled,
        .submit-btn:not(:disabled) {
            opacity: 1;
            pointer-events: auto;
            cursor: pointer;
        }
        
        .submit-btn.enabled:hover,
        .submit-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- 头部 -->
            <div class="header">
                <h1><i class="fas fa-graduation-cap me-3"></i>智能留学选校规划系统</h1>
                <p class="mb-0">基于海量成功案例和AI智能分析，为您提供个性化的选校建议</p>
            </div>
            
            <!-- 表单部分 -->
            <div class="form-section" id="formSection">
                <form id="schoolPlanningForm">
                    
                    <!-- 第一部分：学术背景 -->
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="fas fa-graduation-cap me-3"></i>学术背景 (Academic Profile)
                        </h3>
                        <p class="form-section-subtitle">请填写您的教育背景和学术成绩信息</p>
                    </div>
                    <div class="form-section-content">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">本科/最高学历就读院校 *</label>
                                    <div class="autocomplete-container">
                                        <input type="text" class="form-control" id="undergrad_school" required 
                                               placeholder="如：北京大学" autocomplete="off">
                                        <div class="autocomplete-suggestions" id="school-suggestions"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">院校层次/档次 *</label>
                                    <select class="form-select" id="school_tier" required>
                                        <option value="">请选择</option>
                                        <option value="985">985</option>
                                        <option value="211">211</option>
                                        <option value="双一流">双一流</option>
                                        <option value="普通一本">普通一本</option>
                                        <option value="普通二本">普通二本</option>
                                        <option value="海外院校">海外院校</option>
                                        <option value="其他">其他</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">所学专业 *</label>
                                    <div class="autocomplete-container">
                                        <input type="text" class="form-control" id="major" required 
                                               placeholder="如：计算机科学与技术" autocomplete="off">
                                        <div class="autocomplete-suggestions" id="major-suggestions"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">总 GPA/均分 *</label>
                                    <input type="text" class="form-control" id="gpa" required 
                                           placeholder="如：3.7/4.0 或 88/100 或 Top 5%">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">专业排名 <span class="text-muted">(选填)</span></label>
                                    <input type="text" class="form-control" id="major_ranking" 
                                           placeholder="如：Top 5% 或 5/120">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">专业 GPA/均分 <span class="text-muted">(选填)</span></label>
                                    <input type="text" class="form-control" id="major_gpa" 
                                           placeholder="如：3.8/4.0 或 90/100 或 Top 3%">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">海外交换/访学经历 <span class="text-muted">(选填)</span></label>
                                    <select class="form-select" id="exchange_experience">
                                        <option value="false">无</option>
                                        <option value="true">有</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">核心先修课程 <span class="text-muted">(选填)</span></label>
                                    <input type="text" class="form-control" id="prerequisite_courses" 
                                           placeholder="如：高等数学、线性代数、数据结构">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="has_language_score">
                                        <label class="form-check-label" for="has_language_score">
                                            TOEFL/IELTS 成绩 <span class="text-muted">(选填)</span>
                                        </label>
                                    </div>
                                    <input type="text" class="form-control" id="language_score_text" 
                                           placeholder="如：TOEFL: 105 或 IELTS: 7.0" disabled>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="has_gre_score">
                                        <label class="form-check-label" for="has_gre_score">
                                            GRE/GMAT 成绩 <span class="text-muted">(选填)</span>
                                        </label>
                                    </div>
                                    <input type="text" class="form-control" id="gre_score_text" 
                                           placeholder="如：GRE: 325 或 GMAT: 720" disabled>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">申请学位 *</label>
                                    <select class="form-select" id="target_degree" required>
                                        <option value="">请选择</option>
                                        <option value="硕士">硕士</option>
                                        <option value="博士">博士</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">核心先修课程 <span class="text-muted">(选填)</span></label>
                            <textarea class="form-control" id="prerequisite_courses" rows="3" 
                                      placeholder="若跨专业申请，请填写与目标专业相关的核心课程，如高等数学、数据结构、线性代数等。"></textarea>
                        </div>
                    </div>
                    
                    <!-- 第二部分：实践背景 -->
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="fas fa-briefcase me-3"></i>实践背景 (Practical Experience)
                        </h3>
                        <p class="form-section-subtitle">请填写您的科研、实习、工作经历和项目成果</p>
                    </div>
                    <div class="form-section-content">
                        <div class="form-group">
                            <label class="form-label">科研/实习/工作经历 <span class="text-muted">(选填)</span></label>
                            <div id="experiences-container">
                                <!-- 动态添加的经历项目将在这里显示 -->
                            </div>
                            <button type="button" class="add-item-btn" id="add-experience-btn">
                                <i class="fas fa-plus me-2"></i>添加经历
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">项目成果（论文/专利等） <span class="text-muted">(选填)</span></label>
                            <textarea class="form-control" id="achievements" rows="4" 
                                      placeholder="请在此处列出您的论文、专利、重要项目报告等成果。"></textarea>
                        </div>
                    </div>
                    
                    <!-- 第三部分：申请意向与偏好 -->
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="fas fa-target me-3"></i>申请意向与偏好 (Intentions & Preferences)
                        </h3>
                        <p class="form-section-subtitle">请填写您的申请目标和选校偏好</p>
                    </div>
                    <div class="form-section-content">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">意向国家/地区 * (可多选)</label>
                                    <div id="countries-container">
                                        <span class="country-tag" data-country="美国">美国</span>
                                        <span class="country-tag" data-country="英国">英国</span>
                                        <span class="country-tag" data-country="新加坡">新加坡</span>
                                        <span class="country-tag" data-country="香港">香港</span>
                                        <span class="country-tag" data-country="加拿大">加拿大</span>
                                        <span class="country-tag" data-country="澳大利亚">澳大利亚</span>
                                        <span class="country-tag" data-country="德国">德国</span>
                                        <span class="country-tag" data-country="法国">法国</span>
                                    </div>
                                    <input type="hidden" id="target_countries" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">毕业后去向 <span class="text-muted">(选填)</span></label>
                                    <select class="form-select" id="post_graduation_plan">
                                        <option value="">请选择</option>
                                        <option value="立即回国">立即回国</option>
                                        <option value="先在当地工作">先在当地工作</option>
                                        <option value="不确定">不确定</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">留学总预算 <span class="text-muted">(选填)</span></label>
                                    <select class="form-select" id="budget">
                                        <option value="">请选择</option>
                                        <option value="20万人民币以内">20万人民币以内</option>
                                        <option value="20-30万人民币">20-30万人民币</option>
                                        <option value="30-50万人民币">30-50万人民币</option>
                                        <option value="50-70万人民币">50-70万人民币</option>
                                        <option value="70万人民币以上">70万人民币以上</option>
                                        <option value="预算充足">预算充足</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">意向申请专业 * (可添加1-5个，拖拽排序)</label>
                            <div class="autocomplete-container">
                                <input type="text" class="form-control" id="target-major-input" 
                                       placeholder="输入专业名称，如：计算机科学" autocomplete="off">
                                <div class="autocomplete-suggestions" id="target-major-suggestions"></div>
                            </div>
                            <div id="target-majors-list" class="mt-2">
                                <!-- 已选择的专业将在这里显示 -->
                            </div>
                            <input type="hidden" id="target_majors" required>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="enable_selection_factors">
                                <label class="form-check-label" for="enable_selection_factors">
                                    选校最看重方面 <span class="text-muted">(勾选后可拖拽排序)</span>
                                </label>
                            </div>
                            <div id="selection-factors-container" class="disabled-sorting">
                                <div class="sortable-item" data-factor="综合排名">
                                    <span><i class="fas fa-grip-vertical drag-handle"></i>综合排名</span>
                                </div>
                                <div class="sortable-item" data-factor="专业排名">
                                    <span><i class="fas fa-grip-vertical drag-handle"></i>专业排名</span>
                                </div>
                                <div class="sortable-item" data-factor="地理位置与就业">
                                    <span><i class="fas fa-grip-vertical drag-handle"></i>地理位置与就业</span>
                                </div>
                                <div class="sortable-item" data-factor="学费与性价比">
                                    <span><i class="fas fa-grip-vertical drag-handle"></i>学费与性价比</span>
                                </div>
                                <div class="sortable-item" data-factor="教授与科研实力">
                                    <span><i class="fas fa-grip-vertical drag-handle"></i>教授与科研实力</span>
                                </div>
                                <div class="sortable-item" data-factor="校园文化">
                                    <span><i class="fas fa-grip-vertical drag-handle"></i>校园文化</span>
                                </div>
                            </div>
                            <input type="hidden" id="school_selection_factors">
                        </div>
                    </div>
                    
                    <!-- 提交按钮 -->
                    <div class="submit-btn-container">
                        <button type="submit" class="submit-btn" id="submit-btn">
                            <i class="fas fa-magic me-2"></i>生成我的选校报告
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- 加载状态 -->
            <div class="loading" id="loadingSection">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h4 class="mt-3">正在分析您的背景...</h4>
                <p>AI正在匹配相似案例并生成个性化报告，请稍候</p>
            </div>
            
            <!-- 结果展示 -->
            <div class="results" id="resultsSection">
                <div class="row">
                    <div class="col-12">
                        <h2 class="mb-4"><i class="fas fa-chart-line me-2"></i>您的选校规划报告</h2>
                    </div>
                </div>
                
                <!-- AI分析报告 -->
                <div class="analysis-card">
                    <h3><i class="fas fa-brain me-2"></i>AI智能分析</h3>
                    <div id="analysisContent"></div>
                </div>
                
                <!-- 学校推荐 -->
                <div class="analysis-card">
                    <h3><i class="fas fa-university me-2"></i>选校梯度建议</h3>
                    <div id="recommendationsContent"></div>
                </div>
                
                <!-- 相似案例 -->
                <div class="analysis-card">
                    <h3><i class="fas fa-users me-2"></i>相似背景成功案例</h3>
                    <div id="casesContent"></div>
                </div>
                
                <div class="text-center mt-4">
                    <button class="btn btn-outline-primary" onclick="resetForm()">
                        <i class="fas fa-redo me-2"></i>重新规划
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>