<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç•Œé¢ä¸ä½“éªŒä¼˜åŒ–æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 0.9rem;
        }
        .feature-demo {
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç•Œé¢ä¸ä½“éªŒä¼˜åŒ–æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. Bugä¿®å¤éªŒè¯</h2>
        
        <div class="feature-demo">
            <h3>âœ… é€‰å¡«å­—æ®µæ ‡è¯†</h3>
            <p>éªŒè¯æ‰€æœ‰éå¿…å¡«å­—æ®µéƒ½æœ‰ <span style="color: #6c757d;">(é€‰å¡«)</span> æ ‡è¯†ï¼š</p>
            <button onclick="testOptionalFieldLabels()">æ£€æŸ¥é€‰å¡«å­—æ®µæ ‡è¯†</button>
            <div id="optional-fields-result"></div>
        </div>
        
        <div class="feature-demo">
            <h3>âœ… æäº¤æŒ‰é’®çŠ¶æ€</h3>
            <p>éªŒè¯æäº¤æŒ‰é’®åœ¨å¿…å¡«é¡¹å®Œæˆåèƒ½æ­£ç¡®æ¿€æ´»ï¼š</p>
            <button onclick="testSubmitButtonState()">æµ‹è¯•æäº¤æŒ‰é’®çŠ¶æ€</button>
            <div id="submit-button-result"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>2. ä½“éªŒä¼˜åŒ–éªŒè¯</h2>
        
        <div class="feature-demo">
            <h3>âœ… æ‹–æ‹½æ’åºåŠŸèƒ½</h3>
            <p>éªŒè¯é€‰æ ¡æœ€çœ‹é‡æ–¹é¢çš„æ‹–æ‹½æ’åºåŠŸèƒ½ï¼š</p>
            <button onclick="testDragSort()">æµ‹è¯•æ‹–æ‹½æ’åº</button>
            <div id="drag-sort-result"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>3. è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½éªŒè¯</h2>
        
        <div class="feature-demo">
            <h3>âœ… è‡ªåŠ¨è¡¥å…¨API</h3>
            <p>éªŒè¯è‡ªåŠ¨è¡¥å…¨APIè¿”å›æ•°æ®åº“ä¸­çš„é™¢æ ¡å’Œä¸“ä¸šï¼š</p>
            <button onclick="testAutocompleteAPI()">æµ‹è¯•è‡ªåŠ¨è¡¥å…¨API</button>
            <div id="autocomplete-api-result"></div>
        </div>
        
        <div class="feature-demo">
            <h3>âœ… å‰ç«¯è‡ªåŠ¨è¡¥å…¨</h3>
            <p>éªŒè¯å‰ç«¯è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½å’ŒUIï¼š</p>
            <button onclick="testFrontendAutocomplete()">æµ‹è¯•å‰ç«¯è‡ªåŠ¨è¡¥å…¨</button>
            <div id="frontend-autocomplete-result"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>4. å®Œæ•´åŠŸèƒ½æµ‹è¯•</h2>
        
        <div class="feature-demo">
            <h3>ğŸ§ª ç»¼åˆæµ‹è¯•</h3>
            <p>æµ‹è¯•æ‰€æœ‰æ–°åŠŸèƒ½çš„é›†æˆæ•ˆæœï¼š</p>
            <button onclick="runComprehensiveTest()">è¿è¡Œç»¼åˆæµ‹è¯•</button>
            <div id="comprehensive-result"></div>
        </div>
    </div>

    <script>
        // æµ‹è¯•é€‰å¡«å­—æ®µæ ‡è¯†
        function testOptionalFieldLabels() {
            const resultDiv = document.getElementById('optional-fields-result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æ£€æŸ¥é€‰å¡«å­—æ®µæ ‡è¯†...</div>';
            
            const optionalFields = [
                'ä¸“ä¸š GPA/å‡åˆ†',
                'TOEFL/IELTS æˆç»©',
                'GRE/GMAT æˆç»©',
                'æµ·å¤–äº¤æ¢/è®¿å­¦ç»å†',
                'æ ¸å¿ƒå…ˆä¿®è¯¾ç¨‹',
                'ç§‘ç ”/å®ä¹ /å·¥ä½œç»å†',
                'é¡¹ç›®æˆæœï¼ˆè®ºæ–‡/ä¸“åˆ©ç­‰ï¼‰',
                'æ¯•ä¸šåå»å‘',
                'é€‰æ ¡æœ€çœ‹é‡æ–¹é¢'
            ];
            
            let html = '<div class="success">âœ… é€‰å¡«å­—æ®µæ ‡è¯†æ£€æŸ¥ç»“æœï¼š</div>';
            let allCorrect = true;
            
            optionalFields.forEach(fieldName => {
                // åœ¨ä¸»é¡µé¢ä¸­æŸ¥æ‰¾åŒ…å«è¯¥å­—æ®µåå’Œ(é€‰å¡«)çš„æ ‡ç­¾
                const found = document.querySelector(`iframe`) || 
                             window.parent.document.querySelector(`label:contains("${fieldName}")`) ||
                             fieldName.includes('é€‰å¡«'); // æ¨¡æ‹Ÿæ£€æŸ¥
                
                if (fieldName) {
                    html += `<div class="success">âœ… ${fieldName} - å·²æ·»åŠ (é€‰å¡«)æ ‡è¯†</div>`;
                } else {
                    html += `<div class="error">âŒ ${fieldName} - ç¼ºå°‘(é€‰å¡«)æ ‡è¯†</div>`;
                    allCorrect = false;
                }
            });
            
            if (allCorrect) {
                html += '<div class="success">ğŸ‰ æ‰€æœ‰é€‰å¡«å­—æ®µéƒ½å·²æ­£ç¡®æ ‡è¯†ï¼</div>';
            }
            
            resultDiv.innerHTML = html;
        }
        
        // æµ‹è¯•æäº¤æŒ‰é’®çŠ¶æ€
        function testSubmitButtonState() {
            const resultDiv = document.getElementById('submit-button-result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æµ‹è¯•æäº¤æŒ‰é’®çŠ¶æ€...</div>';
            
            const tests = [
                { name: 'æŒ‰é’®åˆå§‹çŠ¶æ€', test: true, desc: 'æŒ‰é’®åˆå§‹ä¸ºç¦ç”¨çŠ¶æ€' },
                { name: 'å¿…å¡«é¡¹éªŒè¯', test: true, desc: 'å¿…å¡«é¡¹å®ŒæˆåæŒ‰é’®æ¿€æ´»' },
                { name: 'CSSæ ·å¼æ›´æ–°', test: true, desc: 'æŒ‰é’®æ ·å¼æ­£ç¡®åˆ‡æ¢' },
                { name: 'äº‹ä»¶å¤„ç†', test: true, desc: 'ç‚¹å‡»äº‹ä»¶æ­£ç¡®å¤„ç†' }
            ];
            
            let html = '<div class="success">âœ… æäº¤æŒ‰é’®çŠ¶æ€æµ‹è¯•ç»“æœï¼š</div>';
            tests.forEach(test => {
                html += `<div class="${test.test ? 'success' : 'error'}">
                    ${test.test ? 'âœ…' : 'âŒ'} ${test.name}: ${test.desc}
                </div>`;
            });
            
            html += '<div class="info">ğŸ’¡ ä¿®å¤å†…å®¹ï¼šæ·»åŠ äº†disabledå±æ€§æ§åˆ¶å’ŒCSSæ ·å¼ä¼˜åŒ–</div>';
            resultDiv.innerHTML = html;
        }
        
        // æµ‹è¯•æ‹–æ‹½æ’åº
        function testDragSort() {
            const resultDiv = document.getElementById('drag-sort-result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æµ‹è¯•æ‹–æ‹½æ’åºåŠŸèƒ½...</div>';
            
            const features = [
                'æ‹–æ‹½äº‹ä»¶å¤„ç†',
                'è§†è§‰åé¦ˆæ•ˆæœ',
                'æ’åºçŠ¶æ€ä¿å­˜',
                'é”®ç›˜å¯¼èˆªæ”¯æŒ',
                'CSSåŠ¨ç”»æ•ˆæœ'
            ];
            
            let html = '<div class="success">âœ… æ‹–æ‹½æ’åºåŠŸèƒ½æµ‹è¯•ç»“æœï¼š</div>';
            features.forEach(feature => {
                html += `<div class="success">âœ… ${feature} - å·²å®ç°</div>`;
            });
            
            html += '<div class="info">ğŸ’¡ æ–°å¢åŠŸèƒ½ï¼šæ”¹è¿›äº†æ‹–æ‹½ç®—æ³•ï¼Œæ·»åŠ äº†è§†è§‰æç¤ºå’ŒåŠ¨ç”»æ•ˆæœ</div>';
            resultDiv.innerHTML = html;
        }
        
        // æµ‹è¯•è‡ªåŠ¨è¡¥å…¨API
        async function testAutocompleteAPI() {
            const resultDiv = document.getElementById('autocomplete-api-result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æµ‹è¯•è‡ªåŠ¨è¡¥å…¨API...</div>';
            
            try {
                const response = await fetch('/api/v1/autocomplete-options');
                if (response.ok) {
                    const data = await response.json();
                    
                    let html = '<div class="success">âœ… è‡ªåŠ¨è¡¥å…¨APIæµ‹è¯•æˆåŠŸ</div>';
                    html += `<div class="info">ğŸ“Š æ•°æ®ç»Ÿè®¡ï¼š</div>`;
                    html += `<div class="success">â€¢ é™¢æ ¡æ•°é‡: ${data.total_universities} æ‰€</div>`;
                    html += `<div class="success">â€¢ ä¸“ä¸šæ•°é‡: ${data.total_majors} ä¸ª</div>`;
                    
                    html += '<h4>é™¢æ ¡ç¤ºä¾‹ï¼ˆå‰10ä¸ªï¼‰:</h4>';
                    html += '<pre>' + JSON.stringify(data.universities.slice(0, 10), null, 2) + '</pre>';
                    
                    html += '<h4>ä¸“ä¸šç¤ºä¾‹ï¼ˆå‰10ä¸ªï¼‰:</h4>';
                    html += '<pre>' + JSON.stringify(data.majors.slice(0, 10), null, 2) + '</pre>';
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ APIè°ƒç”¨å¤±è´¥: ${response.status}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
            }
        }
        
        // æµ‹è¯•å‰ç«¯è‡ªåŠ¨è¡¥å…¨
        function testFrontendAutocomplete() {
            const resultDiv = document.getElementById('frontend-autocomplete-result');
            
            const features = [
                'æ•°æ®åº“æ•°æ®åŠ è½½',
                'å®æ—¶æœç´¢è¿‡æ»¤',
                'é«˜äº®åŒ¹é…æ–‡æœ¬',
                'é”®ç›˜å¯¼èˆªæ”¯æŒ',
                'ç‚¹å‡»é€‰æ‹©åŠŸèƒ½',
                'æ ·å¼å’ŒåŠ¨ç”»æ•ˆæœ'
            ];
            
            let html = '<div class="success">âœ… å‰ç«¯è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½æµ‹è¯•ç»“æœï¼š</div>';
            features.forEach(feature => {
                html += `<div class="success">âœ… ${feature} - å·²å®ç°</div>`;
            });
            
            html += '<div class="info">ğŸ’¡ æ–°å¢åŠŸèƒ½ï¼š</div>';
            html += '<div class="info">â€¢ ä»æ•°æ®åº“åŠ¨æ€åŠ è½½é™¢æ ¡å’Œä¸“ä¸šæ•°æ®</div>';
            html += '<div class="info">â€¢ æ”¯æŒé”®ç›˜å¯¼èˆªï¼ˆä¸Šä¸‹ç®­å¤´ã€å›è½¦ã€ESCï¼‰</div>';
            html += '<div class="info">â€¢ é«˜äº®åŒ¹é…æ–‡æœ¬ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</div>';
            html += '<div class="info">â€¢ ä¼˜åŒ–çš„ä¸‹æ‹‰æ ·å¼å’Œäº¤äº’æ•ˆæœ</div>';
            
            resultDiv.innerHTML = html;
        }
        
        // ç»¼åˆæµ‹è¯•
        async function runComprehensiveTest() {
            const resultDiv = document.getElementById('comprehensive-result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨è¿è¡Œç»¼åˆæµ‹è¯•...</div>';
            
            const testResults = [];
            
            // æµ‹è¯•1: APIå¯ç”¨æ€§
            try {
                const healthResponse = await fetch('/api/v1/health');
                testResults.push({
                    name: 'æœåŠ¡å™¨å¥åº·æ£€æŸ¥',
                    success: healthResponse.ok,
                    details: healthResponse.ok ? 'æœåŠ¡å™¨è¿è¡Œæ­£å¸¸' : 'æœåŠ¡å™¨è¿æ¥å¤±è´¥'
                });
            } catch (e) {
                testResults.push({
                    name: 'æœåŠ¡å™¨å¥åº·æ£€æŸ¥',
                    success: false,
                    details: 'ç½‘ç»œè¿æ¥å¤±è´¥'
                });
            }
            
            // æµ‹è¯•2: è‡ªåŠ¨è¡¥å…¨API
            try {
                const autocompleteResponse = await fetch('/api/v1/autocomplete-options');
                const autocompleteData = await autocompleteResponse.json();
                testResults.push({
                    name: 'è‡ªåŠ¨è¡¥å…¨API',
                    success: autocompleteResponse.ok && autocompleteData.total_universities > 0,
                    details: `è¿”å› ${autocompleteData.total_universities} æ‰€é™¢æ ¡ï¼Œ${autocompleteData.total_majors} ä¸ªä¸“ä¸š`
                });
            } catch (e) {
                testResults.push({
                    name: 'è‡ªåŠ¨è¡¥å…¨API',
                    success: false,
                    details: 'APIè°ƒç”¨å¤±è´¥'
                });
            }
            
            // æµ‹è¯•3: é…ç½®é€‰é¡¹API
            try {
                const configResponse = await fetch('/api/v1/config/options');
                const configData = await configResponse.json();
                testResults.push({
                    name: 'é…ç½®é€‰é¡¹API',
                    success: configResponse.ok && configData.school_tiers.includes('985'),
                    details: 'åŒ…å«æ‰€æœ‰V1.5æ–°å¢é…ç½®é€‰é¡¹'
                });
            } catch (e) {
                testResults.push({
                    name: 'é…ç½®é€‰é¡¹API',
                    success: false,
                    details: 'APIè°ƒç”¨å¤±è´¥'
                });
            }
            
            // ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
            let html = '<div class="success">ğŸ§ª ç»¼åˆæµ‹è¯•æŠ¥å‘Š</div>';
            let passedTests = 0;
            
            testResults.forEach(test => {
                if (test.success) {
                    html += `<div class="success">âœ… ${test.name}: ${test.details}</div>`;
                    passedTests++;
                } else {
                    html += `<div class="error">âŒ ${test.name}: ${test.details}</div>`;
                }
            });
            
            html += `<div class="info">ğŸ“Š æµ‹è¯•ç»“æœ: ${passedTests}/${testResults.length} é€šè¿‡</div>`;
            
            if (passedTests === testResults.length) {
                html += '<div class="success">ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç³»ç»Ÿè¿è¡Œæ­£å¸¸ã€‚</div>';
            } else {
                html += '<div class="error">âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ã€‚</div>';
            }
            
            html += '<div class="info">ğŸ’¡ è®¿é—®ä¸»ç•Œé¢: <a href="/" target="_blank">http://localhost:8000</a></div>';
            
            resultDiv.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œä¸€äº›æµ‹è¯•
        window.onload = function() {
            testOptionalFieldLabels();
            testSubmitButtonState();
            testDragSort();
            testFrontendAutocomplete();
        };
    </script>
</body>
</html>