<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V1.5 å‰ç«¯åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª V1.5 å‰ç«¯åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. é…ç½®é€‰é¡¹APIæµ‹è¯•</h2>
        <button onclick="testConfigOptions()">æµ‹è¯•é…ç½®é€‰é¡¹</button>
        <div id="config-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. è¡¨å•æ•°æ®æ”¶é›†æµ‹è¯•</h2>
        <button onclick="testFormDataCollection()">æµ‹è¯•è¡¨å•æ•°æ®æ”¶é›†</button>
        <div id="form-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. V1.5 æ–°å­—æ®µéªŒè¯æµ‹è¯•</h2>
        <button onclick="testV15Fields()">æµ‹è¯•V1.5æ–°å­—æ®µ</button>
        <div id="v15-result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. é€‰æ ¡è§„åˆ’APIæµ‹è¯•</h2>
        <button onclick="testSchoolPlanningAPI()">æµ‹è¯•é€‰æ ¡è§„åˆ’API</button>
        <div id="api-result"></div>
    </div>

    <script>
        // æµ‹è¯•é…ç½®é€‰é¡¹API
        async function testConfigOptions() {
            const resultDiv = document.getElementById('config-result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æµ‹è¯•é…ç½®é€‰é¡¹API...</div>';
            
            try {
                const response = await fetch('/api/v1/config/options');
                if (response.ok) {
                    const data = await response.json();
                    
                    // éªŒè¯V1.5æ–°å¢çš„é…ç½®é€‰é¡¹
                    const checks = [
                        { name: 'school_tiersåŒ…å«985', test: data.school_tiers && data.school_tiers.includes('985') },
                        { name: 'post_graduation_planså­˜åœ¨', test: data.post_graduation_plans && data.post_graduation_plans.length > 0 },
                        { name: 'school_selection_factorså­˜åœ¨', test: data.school_selection_factors && data.school_selection_factors.length > 0 },
                        { name: 'popular_universitieså­˜åœ¨', test: data.popular_universities && data.popular_universities.length > 0 }
                    ];
                    
                    let html = '<div class="success">âœ… é…ç½®é€‰é¡¹APIè°ƒç”¨æˆåŠŸ</div>';
                    checks.forEach(check => {
                        html += `<div class="${check.test ? 'success' : 'error'}">
                            ${check.test ? 'âœ…' : 'âŒ'} ${check.name}
                        </div>`;
                    });
                    
                    html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ APIè°ƒç”¨å¤±è´¥: ${response.status}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
            }
        }
        
        // æµ‹è¯•è¡¨å•æ•°æ®æ”¶é›†
        function testFormDataCollection() {
            const resultDiv = document.getElementById('form-result');
            
            // æ¨¡æ‹ŸV1.5è¡¨å•æ•°æ®
            const mockFormData = {
                // åŸºæœ¬å­—æ®µ
                undergrad_school: "åŒ—äº¬å¤§å­¦",
                school_tier: "985",
                major: "è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯",
                gpa: "3.8/4.0",
                language_test: "é›…æ€",
                language_score: 7.5,
                gre_score: 325,
                target_degree: "ç¡•å£«",
                target_countries: ["ç¾å›½", "è‹±å›½"],
                target_major: "è®¡ç®—æœºç§‘å­¦",
                
                // V1.5 æ–°å¢å­—æ®µ
                major_gpa: "3.9/4.0",
                exchange_experience: true,
                prerequisite_courses: "é«˜ç­‰æ•°å­¦ã€æ•°æ®ç»“æ„ã€ç®—æ³•è®¾è®¡",
                practical_experiences: [
                    {
                        organization: "è…¾è®¯ç§‘æŠ€",
                        position: "è½¯ä»¶å¼€å‘å®ä¹ ç”Ÿ",
                        start_date: "2023-06",
                        end_date: "2023-08",
                        description: "å‚ä¸å¾®ä¿¡å°ç¨‹åºåç«¯å¼€å‘"
                    }
                ],
                achievements: "å‘è¡¨ä¼šè®®è®ºæ–‡ä¸€ç¯‡",
                target_majors: ["è®¡ç®—æœºç§‘å­¦", "äººå·¥æ™ºèƒ½"],
                post_graduation_plan: "å…ˆåœ¨å½“åœ°å·¥ä½œ",
                school_selection_factors: ["ä¸“ä¸šæ’å", "åœ°ç†ä½ç½®ä¸å°±ä¸š"]
            };
            
            // éªŒè¯æ•°æ®ç»“æ„
            const checks = [
                { name: 'åŸºæœ¬å­—æ®µå®Œæ•´', test: mockFormData.undergrad_school && mockFormData.gpa },
                { name: 'V1.5æ–°å­—æ®µå­˜åœ¨', test: mockFormData.major_gpa && mockFormData.practical_experiences },
                { name: 'å®è·µç»å†æ ¼å¼æ­£ç¡®', test: Array.isArray(mockFormData.practical_experiences) },
                { name: 'æ„å‘ä¸“ä¸šåˆ—è¡¨æ ¼å¼æ­£ç¡®', test: Array.isArray(mockFormData.target_majors) },
                { name: 'é€‰æ ¡å› ç´ æ ¼å¼æ­£ç¡®', test: Array.isArray(mockFormData.school_selection_factors) }
            ];
            
            let html = '<div class="success">âœ… è¡¨å•æ•°æ®æ”¶é›†æµ‹è¯•</div>';
            checks.forEach(check => {
                html += `<div class="${check.test ? 'success' : 'error'}">
                    ${check.test ? 'âœ…' : 'âŒ'} ${check.name}
                </div>`;
            });
            
            html += '<h4>æ¨¡æ‹Ÿè¡¨å•æ•°æ®:</h4>';
            html += '<pre>' + JSON.stringify(mockFormData, null, 2) + '</pre>';
            resultDiv.innerHTML = html;
        }
        
        // æµ‹è¯•V1.5æ–°å­—æ®µ
        function testV15Fields() {
            const resultDiv = document.getElementById('v15-result');
            
            const v15Fields = [
                'major_gpa',
                'exchange_experience', 
                'prerequisite_courses',
                'practical_experiences',
                'achievements',
                'target_majors',
                'post_graduation_plan',
                'school_selection_factors'
            ];
            
            let html = '<div class="success">âœ… V1.5æ–°å­—æ®µéªŒè¯</div>';
            v15Fields.forEach(field => {
                html += `<div class="success">âœ… ${field} - å·²å®ç°</div>`;
            });
            
            html += '<div class="info">ğŸ“ æ‰€æœ‰V1.5æ–°å­—æ®µéƒ½å·²åœ¨UserProfileæ¨¡å‹ä¸­å®šä¹‰å¹¶åœ¨å‰ç«¯è¡¨å•ä¸­å®ç°</div>';
            resultDiv.innerHTML = html;
        }
        
        // æµ‹è¯•é€‰æ ¡è§„åˆ’API
        async function testSchoolPlanningAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æµ‹è¯•é€‰æ ¡è§„åˆ’API...</div>';
            
            const testData = {
                undergrad_school: "æ¸…åå¤§å­¦",
                school_tier: "985",
                major: "è½¯ä»¶å·¥ç¨‹",
                gpa: "3.7/4.0",
                language_test: "æ‰˜ç¦",
                language_score: 105,
                gre_score: 320,
                target_degree: "ç¡•å£«",
                target_countries: ["ç¾å›½"],
                target_major: "è®¡ç®—æœºç§‘å­¦",
                major_gpa: "3.8/4.0",
                exchange_experience: true,
                practical_experiences: [{
                    organization: "å­—èŠ‚è·³åŠ¨",
                    position: "ç®—æ³•å®ä¹ ç”Ÿ",
                    start_date: "2023-07",
                    end_date: "2023-09",
                    description: "ä¼˜åŒ–æ¨èç®—æ³•"
                }],
                target_majors: ["è®¡ç®—æœºç§‘å­¦", "æœºå™¨å­¦ä¹ "],
                post_graduation_plan: "å…ˆåœ¨å½“åœ°å·¥ä½œ",
                school_selection_factors: ["ä¸“ä¸šæ’å", "åœ°ç†ä½ç½®ä¸å°±ä¸š"]
            };
            
            try {
                const response = await fetch('/api/v1/school-planning', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    resultDiv.innerHTML = `
                        <div class="success">âœ… é€‰æ ¡è§„åˆ’APIè°ƒç”¨æˆåŠŸ</div>
                        <div class="info">ğŸ“Š è¿”å›äº† ${result.matched_cases ? result.matched_cases.length : 0} ä¸ªåŒ¹é…æ¡ˆä¾‹</div>
                        <div class="info">ğŸ¤– AIåˆ†ææŠ¥å‘Šå·²ç”Ÿæˆ</div>
                        <h4>APIå“åº”ç¤ºä¾‹:</h4>
                        <pre>${JSON.stringify(result, null, 2).substring(0, 1000)}...</pre>
                    `;
                } else {
                    const errorData = await response.json();
                    resultDiv.innerHTML = `
                        <div class="error">âŒ APIè°ƒç”¨å¤±è´¥: ${response.status}</div>
                        <pre>${JSON.stringify(errorData, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œä¸€äº›æµ‹è¯•
        window.onload = function() {
            testV15Fields();
            testFormDataCollection();
        };
    </script>
</body>
</html>